wallpanel_screensaver:
  enabled: true
  idle_time: 60
  weather_entity: weather.obolon_home
  image_url: ''
  info_update_interval: 30
  hour_12: false
  info_template: |
    <div id="wallpanel-screensaver-info-weather">
      <table>
          <tr>
              <th><img id="weather-temperature-icon" src="{{ filesParentPath }}/weather-icons/thermometer.svg"/></th>
              <th>{{ states['sensor.air_outdoor_temp'].state }}°&ensp;</th>
              <th><img id="weather-state-icon" src="{{ filesParentPath }}/weather-icons/{{ states[config.weather_entity].state }}-sun-{{ states["sun.sun"].state.replace("_", "-"); }}.svg"/></th>
            <th>{{ states[config.weather_entity].state.replace(/(^|\s)[A-Za-zÀ-ÖØ-öø-ÿ]/g, c => c.toUpperCase()) }}</th>
          </tr>
      </table>
    </div>
    <div id="wallpanel-screensaver-info-time">{{ (new Date()).toLocaleTimeString(undefined, {hour: "2-digit", minute:"2-digit", hour12: config.hour_12}) }}</div>
    <div id="wallpanel-screensaver-info-date">{{ (new Date()).toLocaleDateString(undefined, {weekday: "short", year: "numeric", month: "short", day: "numeric"}) }}</div>
  night_mode:
    start_time: '22:00'
    end_time: '06:00'
    black_screen_after_time: 15
    idle_time: 60
    info_update_interval: 30
kiosk_mode:
  user_settings:
    - users:
        - Wallscreen
      hide_sidebar: true
views:
  - theme: Backend-selected
    icon: mdi:floor-plan
    badges: []
    panel: true
    cards:
      - type: vertical-stack
        cards:
          - type: horizontal-stack
            cards:
              - type: custom:floorplan-card
                full_height: true
                config:
                  image: /local/floorplan/wallscreen.svg
                  stylesheet: /local/floorplan/wallscreen.css
                  defaults:
                    hover_action: none
                    tap_action: none
                    double_tap_action: none
                    hold_action: none
                  functions: |
                    >
                      return {
                        lightStyles: (switchEntity, lightEntity) => {
                          if (entities[switchEntity].state === 'off') return 'fill: #000000; fill-opacity: 0.5';
                          var rgbColor = entities[lightEntity].attributes.rgb_color;
                          var color = (typeof rgbColor === "undefined")? '#000000' : "rgb(" + rgbColor[0] + ", " + rgbColor[1] + ", " + rgbColor[2] + ")";
                          var bri = states[lightEntity].attributes.brightness / 255 * 0.5;
                          var opacity = bri.toString();

                          return `fill: ${color}; fill-opacity: ${opacity}`;
                        },
                        airTextWithCO2: (tempEntity, humEntity, co2Entity) => {
                          if (entities[tempEntity].state === undefined) return 'Offline';

                          return `${entities[tempEntity].state}° ${entities[humEntity].state}% ${parseInt(entities[co2Entity].state)} CO₂`;
                        },
                        airText: (tempEntity, humEntity) => {
                          if (entities[tempEntity].state === undefined) return 'Offline';

                          return `${entities[tempEntity].state}° ${entities[humEntity].state}%`;
                        },
                      };
                  rules:
                    - name: Fans
                      entities:
                        - entity: switch.fan_bathroom
                          element: switch.fan_bathroom
                        - entity: switch.fan_wc
                          element: switch.fan_wc
                      tap_action: toggle
                      state_action:
                        service: floorplan.class_set
                        service_data:
                          class: |
                            >
                              return (entity.state === 'on')? 'spinning' : '';
                    - name: Bathroom light
                      entity: switch.light_bathroom_main
                      element: light.bathroom_main
                      tap_action: toggle
                      double_tap_action:
                        - action: call-service
                          service: browser_mod.popup
                          service_data:
                            title: Ванна
                            card:
                              type: vertical-stack
                              cards:
                                - type: entities
                                  entities:
                                    - entity: switch.light_bathroom_main
                                    - entity: switch.light_bathroom_secondary
                                    - entity: switch.fan_bathroom
                                - type: conditional
                                  conditions:
                                    - entity: switch.light_bathroom_main
                                      state: 'on'
                                  card:
                                    type: custom:more-info-card
                                    entity: light.bathroom
                                    title: ' '
                      state_action:
                        - action: call-service
                          service: floorplan.class_set
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.bathroom_main
                            style: |
                              >
                                return functions.lightStyles('switch.light_bathroom_main', 'light.bathroom');
                    - name: Bathroom light bulb
                      entity: light.bathroom
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.bathroom_main
                            style: |
                              >
                                return functions.lightStyles('switch.light_bathroom_main', 'light.bathroom');
                    - name: Bathroom light mirror
                      entity: switch.light_bathroom_secondary
                      element: light.bathroom_secondary
                      tap_action: toggle
                      state_action:
                        service: floorplan.class_set
                        service_data:
                          class: |
                            >
                              return (entity.state === 'on')? 'light-on' : '';
                    - name: WC light
                      entity: switch.light_wc
                      element: light.wc
                      double_tap_action:
                        - action: call-service
                          service: browser_mod.popup
                          service_data:
                            title: Туалет
                            card:
                              type: vertical-stack
                              cards:
                                - type: entities
                                  entities:
                                    - entity: switch.light_wc
                                    - entity: switch.fan_wc
                                - type: conditional
                                  conditions:
                                    - entity: switch.light_wc
                                      state: 'on'
                                  card:
                                    type: custom:more-info-card
                                    entity: light.wc
                                    title: ' '
                      tap_action: toggle
                      state_action:
                        - action: call-service
                          service: floorplan.class_set
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.wc
                            style: |
                              >
                                return functions.lightStyles('switch.light_wc', 'light.wc');
                    - name: WC light bulb
                      entity: light.wc
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.wc
                            style: |
                              >
                                return functions.lightStyles('switch.light_wc', 'light.wc');
                    - name: Hallway light
                      entity: switch.light_hallway
                      element: light.hallway
                      double_tap_action:
                        - action: call-service
                          service: browser_mod.popup
                          service_data:
                            title: Коридор
                            card:
                              type: vertical-stack
                              cards:
                                - type: entities
                                  entities:
                                    - entity: switch.light_hallway
                                - type: conditional
                                  conditions:
                                    - entity: switch.light_hallway
                                      state: 'on'
                                  card:
                                    type: custom:more-info-card
                                    entity: light.hallway
                                    title: ' '
                      tap_action: toggle
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.hallway
                            style: |
                              >
                                return functions.lightStyles('switch.light_hallway', 'light.hallway');
                    - name: Hallway light bulb
                      entity: light.hallway
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.hallway
                            style: |
                              >
                                return functions.lightStyles('switch.light_hallway', 'light.hallway');
                    - name: Kitchen light
                      entity: switch.light_kitchen
                      element: light.kitchen
                      double_tap_action:
                        - action: call-service
                          service: browser_mod.popup
                          service_data:
                            title: Коридор
                            card:
                              type: vertical-stack
                              cards:
                                - type: entities
                                  entities:
                                    - entity: switch.light_kitchen
                                - type: conditional
                                  conditions:
                                    - entity: switch.light_kitchen
                                      state: 'on'
                                  card:
                                    type: custom:more-info-card
                                    entity: light.kitchen
                                    title: ' '
                      tap_action: toggle
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.kitchen
                            style: |
                              >
                                return functions.lightStyles('switch.light_kitchen', 'light.kitchen');
                    - name: Kitchen light bulb
                      entity: light.kitchen
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.kitchen
                            style: |
                              >
                                return functions.lightStyles('switch.light_kitchen', 'light.kitchen');
                    - name: Bedroom light
                      entity: switch.light_bedroom
                      element: light.bedroom
                      double_tap_action:
                        - action: call-service
                          service: browser_mod.popup
                          service_data:
                            title: Коридор
                            card:
                              type: vertical-stack
                              cards:
                                - type: entities
                                  entities:
                                    - entity: switch.light_bedroom
                                - type: conditional
                                  conditions:
                                    - entity: switch.light_bedroom
                                      state: 'on'
                                  card:
                                    type: custom:more-info-card
                                    entity: light.bedroom
                                    title: ' '
                      tap_action: toggle
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.bedroom
                            style: |
                              >
                                return functions.lightStyles('switch.light_bedroom', 'light.bedroom');
                    - name: Bedroom light bulb
                      entity: light.bedroom
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.bedroom
                            style: |
                              >
                                return functions.lightStyles('switch.light_bedroom', 'light.bedroom');
                    - name: Living room light
                      entity: switch.light_living_room
                      element: light.living_room
                      tap_action: toggle
                      double_tap_action:
                        - action: call-service
                          service: browser_mod.popup
                          service_data:
                            title: Вітальня
                            card:
                              type: vertical-stack
                              cards:
                                - type: entities
                                  entities:
                                    - entity: switch.light_living_room
                                - type: conditional
                                  conditions:
                                    - entity: switch.light_living_room
                                      state: 'on'
                                  card:
                                    type: custom:more-info-card
                                    entity: light.living_room
                                    title: ' '
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.living_room
                            style: |
                              >
                                return functions.lightStyles('switch.light_living_room', 'light.living_room');
                    - name: Living room light bulb
                      entity: light.living_room
                      tap_action: more-info
                      state_action:
                        - action: call-service
                          service: floorplan.style_set
                          service_data:
                            element: light.living_room
                            style: |
                              >
                                return functions.lightStyles('switch.light_living_room', 'light.living_room');
                    - name: Bedroom air
                      entities:
                        - entity: sensor.air_bedroom_temp
                        - entity: sensor.air_bedroom_humidity
                        - entity: sensor.air_bedroom_co2
                      state_action:
                        - action: call-service
                          service: floorplan.text_set
                          service_data:
                            element: air.bedroom
                            text: |
                              >
                                return functions.airTextWithCO2('sensor.air_bedroom_temp', 'sensor.air_bedroom_humidity', 'sensor.air_bedroom_co2');
                    - name: Balcony air
                      entities:
                        - entity: sensor.air_balcony_temp
                        - entity: sensor.air_balcony_humidity
                        - entity: sensor.air_balcony_co2
                      state_action:
                        - action: call-service
                          service: floorplan.text_set
                          service_data:
                            element: air.balcony
                            text: |
                              >
                                return functions.airTextWithCO2('sensor.air_balcony_temp', 'sensor.air_balcony_humidity', 'sensor.air_balcony_co2');
                    - name: Outdoor air
                      entities:
                        - entity: sensor.air_outdoor_temp
                        - entity: sensor.air_outdoor_humidity
                      state_action:
                        - action: call-service
                          service: floorplan.text_set
                          service_data:
                            element: air.outdoor
                            text: |
                              >
                                return functions.airText('sensor.air_outdoor_temp', 'sensor.air_outdoor_humidity');
                    - name: Living room air
                      entities:
                        - entity: sensor.air_living_room_temp
                        - entity: sensor.air_living_room_humidity
                        - entity: sensor.air_living_room_co2
                      state_action:
                        - action: call-service
                          service: floorplan.text_set
                          service_data:
                            element: air.living_room
                            text: |
                              >
                                return functions.airTextWithCO2('sensor.air_living_room_temp', 'sensor.air_living_room_humidity', 'sensor.air_living_room_co2');
                    - name: Robot vacuum
                      element: button.robot_vacuum
                      tap_action:
                        action: navigate
                        navigation_path: /lovelace-wallscreen/1
                      double_tap_action:
                        action: call-service
                        service: vacuum.start
                        service_data:
                          entity_id: vacuum.roborock_s6
                    - name: Living room climate btn
                      entity: input_boolean.climate_living_room
                      element: button.climate_living_room
                      tap_action: toggle
                      state_action:
                        - action: call-service
                          service: floorplan.class_set
                          service_data:
                            element: icon.climate_living_room
                            class: |
                              >
                                return (entity.state === 'on')? 'btn-power-on' : '';
                        - action: call-service
                          service: floorplan.class_set
                          service_data:
                            element: button.climate_val_living_room
                            class: |
                              >
                                return (entity.state === 'on')? '' : 'hidden';
                    - name: Living room climate value btn
                      entity: input_number.climate_living_room_temp
                      element: button.climate_val_living_room
                      state_action:
                        - action: call-service
                          service: floorplan.text_set
                          service_data:
                            element: value.climate_living_room
                            text: |
                              >
                                return `${parseInt(entity.state)}°`;
                    - name: Bedroom climate btn
                      entity: input_boolean.climate_bedroom
                      element: button.climate_bedroom
                      tap_action: toggle
                      state_action:
                        - action: call-service
                          service: floorplan.class_set
                          service_data:
                            element: icon.climate_bedroom
                            class: |
                              >
                                return (entity.state === 'on')? 'btn-power-on' : '';
                        - action: call-service
                          service: floorplan.class_set
                          service_data:
                            element: button.climate_val_bedroom
                            class: |
                              >
                                return (entity.state === 'on')? '' : 'hidden';
                    - name: Bedroom climate value btn
                      entity: input_number.climate_bedroom_temp
                      element: button.climate_val_bedroom
                      state_action:
                        - action: call-service
                          service: floorplan.text_set
                          service_data:
                            element: value.climate_bedroom
                            text: |
                              >
                                return `${parseInt(entity.state)}°`;
  - theme: Backend-selected
    icon: mdi:robot-vacuum
    badges: []
    panel: true
    cards:
      - type: grid
        columns: 2
        cards:
          - type: vertical-stack
            cards:
              - type: custom:xiaomi-vacuum-map-card
                map_source:
                  camera: camera.xiaomi_cloud_map_extractor
                  crop:
                    top: 210
                    bottom: 210
                calibration_source:
                  camera: true
                entity: vacuum.roborock_s6
                vacuum_platform: default
                two_finger_pan: false
                map_locked: false
          - type: vertical-stack
            cards:
              - type: custom:more-info-card
                entity: vacuum.roborock_s6
                title: ' '
              - type: custom:button-card
                icon: mdi:broom
                layout: icon_name
                aspect_ratio: 8/1
                name: Прибирання кімнат
                styles:
                  icon:
                    - color: |
                        [[[
                          var hasRoom = false;
                          if (states['input_boolean.vacuum_hallway'].state === 'on') hasRoom = true;
                          if (states['input_boolean.vacuum_living_room'].state === 'on') hasRoom = true;
                          if (states['input_boolean.vacuum_kitchen'].state === 'on') hasRoom = true;
                          if (states['input_boolean.vacuum_bedroom'].state === 'on') hasRoom = true;
                          return (hasRoom)? 'rgb(68, 115, 158)' : '#AAAAAA';
                        ]]]
                tap_action:
                  action: |
                    [[[
                      var hasRoom = false;
                      if (states['input_boolean.vacuum_hallway'].state === 'on') hasRoom = true;
                      if (states['input_boolean.vacuum_living_room'].state === 'on') hasRoom = true;
                      if (states['input_boolean.vacuum_kitchen'].state === 'on') hasRoom = true;
                      if (states['input_boolean.vacuum_bedroom'].state === 'on') hasRoom = true;
                      return (hasRoom)? 'call-service' : 'none';
                    ]]]
                  service: xiaomi_miio.vacuum_clean_segment
                  service_data:
                    entity_id: vacuum.roborock_s6
                    segments: |
                      [[[
                        var segments = [];
                        if (states['input_boolean.vacuum_hallway'].state === 'on') segments.push(16);
                        if (states['input_boolean.vacuum_living_room'].state === 'on') segments.push(18);
                        if (states['input_boolean.vacuum_kitchen'].state === 'on') segments.push(19);
                        if (states['input_boolean.vacuum_bedroom'].state === 'on') segments.push(17);
                        return segments;
                      ]]]
              - type: custom:floorplan-card
                config:
                  image: /local/floorplan/vacuum-plan.svg
                  stylesheet: /local/floorplan/vacuum-plan.css
                  defaults:
                    hover_action: none
                    tap_action: toggle
                    double_tap_action: none
                    hold_action: none
                  rules:
                    - name: Areas
                      entities:
                        - entity: input_boolean.vacuum_hallway
                          element: hallway
                        - entity: input_boolean.vacuum_kitchen
                          element: kitchen
                        - entity: input_boolean.vacuum_living_room
                          element: living_room
                        - entity: input_boolean.vacuum_bedroom
                          element: bedroom
                      state_action:
                        service: floorplan.class_set
                        service_data:
                          class: |
                            >
                              return (entity.state === 'on')? 'vacuum-area-enabled' : 'vacuum-area-disabled';
